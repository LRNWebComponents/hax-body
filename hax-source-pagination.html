<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<dom-module id="hax-source-pagination">
  <template>
    <style>
      :host {
        display: flex;
      }
    </style>
    <div id="container">

      <template is="dom-if" if="[[_showPager(_rangeArray)]]">
        <paper-icon-button icon="first-page" data-event="first-page" disabled="[[_isActive(start, current)]]"></paper-icon-button>

        <template is="dom-repeat" items="[[_rangeArray]]" as="page">
          <paper-button data-event="page" data-page$="[[page]]" disabled="[[_isActive(page, current)]]">[[page]]</paper-button>
        </template>

        <paper-icon-button icon="last-page" data-event="last-page" disabled="[[_isActive(range, current)]]"></paper-icon-button>
      </template>

    </div>
  </template>
  <script>
    Polymer({
      is: 'hax-source-pagination',
      properties: {
        /**
         * Total number of results
         */
        total: {
          type: Number,
          value: 0
        },
        /**
         * What page to start the pager
         */
        start: {
          type: Number,
          value: 0
        },
        /**
         * Total number of pages
         */
        range: {
          type: Number,
          value: 0
        },
        /**
         * Current page number
         */
        current: {
          type: Number,
          value: 0
        },
        /**
         * How many results are currently being shown
         */
        count: {
          type: Number,
          value: 0
        },
        _rangeArray: {
          type: Array,
          computed: '_computeRangeArray(range)'
        }
      },
      /**
       * Assemble an array of the range
       */
      _computeRangeArray: function (range) {
        let _range = Number(range);
        let rangeArray = [];
        while (range >= 0) {
          rangeArray.unshift(range)
          range--;
        }
        return rangeArray;
      },
      _isActive: function (page, current) {
        return Number(page) === Number(current);
      },
      _showPager: function (rangeArray) {
        return rangeArray.length > 0;
      },
      ready: function () {
        this.$.container.addEventListener('click', (e) => {
          let target = Polymer.dom(e).localTarget;
          const eventName = target.getAttribute('data-event');
          // check to see if we have an event name to work with
          if (eventName) {
            switch (eventName) {
              case 'page':
                let page = target.getAttribute('data-page');
                this.fire('change-page', { page: Number(page) });
                break;
              
              case 'first-page':
                this.fire('change-page', { page:  Number(this.start) });
                break;

              case 'last-page':
                this.fire('change-page', { page: Number(this.start + this.range) });
                break;

              default:
                break;
            }
          }
        });
      }
    });
  </script>
</dom-module>
